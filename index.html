



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Reefer Container Predictive Maintenance</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#reefer-anomaly-detection-solution" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="Reefer Container Predictive Maintenance" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Reefer Container Predictive Maintenance
            </span>
            <span class="md-header-nav__topic">
              Introduction
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="Reefer Container Predictive Maintenance" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Reefer Container Predictive Maintenance
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introduction
      </label>
    
    <a href="." title="Introduction" class="md-nav__link md-nav__link--active">
      Introduction
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvp-component-view" title="MVP component view" class="md-nav__link">
    MVP component view
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites-to-build-and-run-this-solution" title="Pre-requisites to build and run this solution" class="md-nav__link">
    Pre-requisites to build and run this solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-sure-to-have-event-stream-or-a-kafka-cluster-running-somewhere" title="Be sure to have Event Stream or a Kafka cluster running somewhere" class="md-nav__link">
    Be sure to have Event Stream or a Kafka cluster running somewhere
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-a-postgresql-service" title="Provision a Postgresql service" class="md-nav__link">
    Provision a Postgresql service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-environment-variables" title="Set environment variables" class="md-nav__link">
    Set environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-python-development-environment-as-docker-image" title="Building a python development environment as docker image" class="md-nav__link">
    Building a python development environment as docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image-for-jupyter-notebook" title="Build the docker image for Jupyter notebook" class="md-nav__link">
    Build the docker image for Jupyter notebook
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-postgresql-database" title="Create the postgresql database" class="md-nav__link">
    Create the postgresql database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-approach" title="Project approach" class="md-nav__link">
    Project approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#devops" title="DevOps" class="md-nav__link">
    DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataops" title="DataOps" class="md-nav__link">
    DataOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlops" title="MLOps" class="md-nav__link">
    MLOps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-readings" title="Further Readings" class="md-nav__link">
    Further Readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-data-ai-analytics/methodology/" title="Methodology used" class="md-nav__link">
      Methodology used
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Collect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Collect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Preparing data for demonstration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Preparing data for demonstration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="collect/products-postgres/" title="Get products into postgresql" class="md-nav__link">
      Get products into postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="collect/generate-telemetry/" title="Generate telemetry data" class="md-nav__link">
      Generate telemetry data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="collect/oss-collect-data/" title="Collect data with open source solution" class="md-nav__link">
      Collect data with open source solution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="collect/cp4d-collect-data/" title="Collect data with cloud pak for data" class="md-nav__link">
      Collect data with cloud pak for data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="organize/readme/" title="Organize" class="md-nav__link">
      Organize
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Analyze
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Analyze
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="analyze/oss-ml-dev/" title="Define the anomaly detection scoring model with OSS" class="md-nav__link">
      Define the anomaly detection scoring model with OSS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="analyze/predictive-maintenance/" title="Reefer anomaly detection problem" class="md-nav__link">
      Reefer anomaly detection problem
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Infuse
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Infuse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="infuse/dev-scoring/" title="Develop scoring app with cloud pak for application" class="md-nav__link">
      Develop scoring app with cloud pak for application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="infuse/build-run/" title="Build and run the solution on Openshift" class="md-nav__link">
      Build and run the solution on Openshift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="infuse/bpm/" title="Engineer dispatching with Business process with Cloud Pak for Automation" class="md-nav__link">
      Engineer dispatching with Business process with Cloud Pak for Automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="infuse/integration-tests/" title="Run integration tests" class="md-nav__link">
      Run integration tests
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/" title="Reefer solution implementation project" class="md-nav__link">
      Reefer solution implementation project
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvp-component-view" title="MVP component view" class="md-nav__link">
    MVP component view
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites-to-build-and-run-this-solution" title="Pre-requisites to build and run this solution" class="md-nav__link">
    Pre-requisites to build and run this solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#be-sure-to-have-event-stream-or-a-kafka-cluster-running-somewhere" title="Be sure to have Event Stream or a Kafka cluster running somewhere" class="md-nav__link">
    Be sure to have Event Stream or a Kafka cluster running somewhere
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-a-postgresql-service" title="Provision a Postgresql service" class="md-nav__link">
    Provision a Postgresql service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-environment-variables" title="Set environment variables" class="md-nav__link">
    Set environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-python-development-environment-as-docker-image" title="Building a python development environment as docker image" class="md-nav__link">
    Building a python development environment as docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image-for-jupyter-notebook" title="Build the docker image for Jupyter notebook" class="md-nav__link">
    Build the docker image for Jupyter notebook
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-postgresql-database" title="Create the postgresql database" class="md-nav__link">
    Create the postgresql database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-approach" title="Project approach" class="md-nav__link">
    Project approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#devops" title="DevOps" class="md-nav__link">
    DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataops" title="DataOps" class="md-nav__link">
    DataOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlops" title="MLOps" class="md-nav__link">
    MLOps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-readings" title="Further Readings" class="md-nav__link">
    Further Readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="reefer-anomaly-detection-solution">Reefer Anomaly Detection Solution</h1>
<p>This project is to demonstrate how to perform real time analytics, like anomaly detection for Reefer container in the shipping industry, using Reefer container telemetry event stream. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This project is part of the <a href="https://ibm-cloud-architecture.github.io/refarch-kc/">reference implementation solution</a>  to demonstrate the IBM <a href="https://ibm-cloud-architecture.github.io/refarch-eda">event driven reference architecture</a> but it also presents how to combine different IBM cloud paks to build the solution: Cloud pak for data, for automation, for integration and for application.</p>
</div>
<p>As we will detail in next section there are four components in this solution that make the anomaly detection: a Reefer simulator (we do not have such Reefer container in our stock), a container microservice, an analytics scoring agent and a business process. The diagram below is a very high level view of the components in a three layer architecture with Openshift for the deployment infrastructure.</p>
<p><img alt="" src="images/ibm-cp.png" /></p>
<p>We also look at an open source version of this solution using an approach close to <a href="http://opendatahub.io/">opendatahub.io</a> proposed architecture, as illustrated in the following diagram:</p>
<p><img alt="" src="images/RT-analytics.png" /></p>
<p>The Reefer container is an IoT device, which emits container telemetries every 10 minutes via the MQTT protocol. The first component receiving those messages is <a href="">Apache Nifi</a> to transform the telemetry message to a kafka event. Kafka is used as the event backbone and event sourcing so microservices, deployed on Openshift, can consume and publish messages.</p>
<p>For persistence reason, we may leverage big data type of storage like Postgresql or Cassandra to persist the container's telemetry over a longer time period. This datasource is used by the Data Scientists to do its data preparation and build training and test sets and select the best model. We also illustrate how to connect to Kafka topic as data source, from a Jupyter notebook.</p>
<p>Data scientists can run Jupyter lab on OpenShift and build a model to be deployed as python microservice, consumer of Reefer telemetry events. When anomaly is detected, a new  event is posted to the <code>containers</code> topic so the Reefer container manager microservice can apply the expected business logic. </p>
<h2 id="mvp-component-view">MVP component view</h2>
<p>For a minimum viable demonstration the runtime components looks like in the figure below:</p>
<p><img alt="" src="images/mvp-runtime.png" /></p>
<ol>
<li>
<p>A web app, deployed on Openshift, is running a simulator to simulate the generation of Reefer container telemetries while the container is at sea or during end to end transportation. The app exposes a simple POST operation with a control object to control the simulation. Here is an example of such <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/blob/master/scripts/simulControl.json">control.json</a> object</p>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="err">&#39;containerID&#39;:</span> <span class="err">&#39;C02&#39;,</span>
<span class="err">&#39;simulation&#39;:</span> <span class="err">&#39;co2sensor&#39;,</span>
<span class="err">&#39;nb_of_records&#39;:</span> <span class="err">1000,</span>
<span class="nt">&quot;product_id&quot;</span><span class="p">:</span>  <span class="s2">&quot;P02&quot;</span>
<span class="p">}</span>
</pre></div>

<p>The simulation can be done on o2sensor, co2sensor or power. </p>
</li>
<li>
<p>A curl script does the HTTP POST request of this json object. <a href="#test-sending-a-simulation-control-to-the-post-api">See this paragraph.</a></p>
</li>
<li>The telemetry events are sent to the <code>reeferTelemetries</code> topic in Kafka.</li>
<li>The predictive scoring is a consumer of such events, read one event at a time and call the model internally, then sends a new event when maintenance is required. <a href="analyze/oss-ml-dev/">See the note</a> for details.</li>
<li>The maintenance requirement is an event in the <code>containers</code> topic.</li>
<li>The 6<sup>th</sup> component of the solution, is the <a href="https://ibm-cloud-architecture.github.io/refarch-kc-container-ms/">container microservice</a> which was defined in the EDA reference implementation.</li>
<li>The <a href="infuse/bpm/">maintenance engineer intervention process</a> is modeled in BPM, deploy on public cloud and the process application is exposed as API. The container identifier and the telemetry record is sent as input to the process.</li>
</ol>
<h2 id="pre-requisites-to-build-and-run-this-solution">Pre-requisites to build and run this solution</h2>
<p>Start by cloning this project using the command:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/ibm-cloud-architecture/refarch-reefer-ml
</pre></div>

<h3 id="be-sure-to-have-event-stream-or-a-kafka-cluster-running-somewhere">Be sure to have Event Stream or a Kafka cluster running somewhere</h3>
<p>We recommend creating the Event Stream service using the <a href="https://cloud.ibm.com/catalog/services/event-streams">IBM Cloud catalog</a>, you can also read our <a href="https://ibm-cloud-architecture.github.io/refarch-eda/deployments/eventstreams/es-ibm-cloud/">quick article</a> on how to deploy event stream. </p>
<p><em>As an alternate approach, we have deployed Event Stream on Openshift running on-premise servers following the product documentation <a href="https://ibm.github.io/event-streams/installing/installing-openshift/">here</a>.</em> </p>
<p>The following diagram illustrates the needed Kafka topics configured in IBM Cloud Event Stream service:</p>
<p><img alt="" src="images/es-topics.png" /></p>
<p>With IBM Cloud deployment use the service credentials to create new credentials to get the Kafka brokers list, the admin URL and the api key needed to authenticate the consumers and the producers.</p>
<p>For Event Streams on Openshift deployment, click to the <code>connect to the cluster</code> button to get the broker URL and to generate the API key: select the option to generate the key for all topics.</p>
<p><img alt="" src="images/cluster-access.png" /></p>
<h3 id="provision-a-postgresql-service">Provision a Postgresql service</h3>
<p>If you plan to use Postgresql as a data source instead of using csv file, then you need to provision a Postgresql service in IBM Cloud. Use the <a href="https://cloud.ibm.com/docs/services/databases-for-postgresql">product documentation</a> to provision your own service. Define service credential and use the <code>composed</code> url, the database name and the SSL certificate. Use the following commands to get the certificate:</p>
<div class="codehilite"><pre><span></span>ibmcloud login
ibmcloud cdb cacert &lt;database deployment name&gt;
</pre></div>

<p>Save this file as <code>postgres.pem</code> under the simulator folder.</p>
<h3 id="set-environment-variables">Set environment variables</h3>
<p>As part of the <a href="https://12factor.net/">12 factors practice</a>, we externalize the end points configuration in environment variables. We are providing a script template (<code>scripts/setenv-tmp.sh</code>) to set those variables for your local development. Rename this file as <code>setenv.sh</code>. This file is git ignored, to do not share keys and passwords in public domain.</p>
<p>The variables help the different code in the solution to access the Event Stream broker cluster and the Postgresql service running on IBM Cloud.</p>
<h3 id="building-a-python-development-environment-as-docker-image">Building a python development environment as docker image</h3>
<p>To avoid impacting our laptop environment (specially macbook which use python), we use a dockerfile to get the basic of python 3.7.x and the python modules like kafka, http requests, pandas, sklearn, pytest... we need to develop and test the different python code of this solution. To build your python image with all the needed libraries, use the following commands:</p>
<div class="codehilite"><pre><span></span>cd docker
docker build -f docker-python-tools -t ibmcase/python .
</pre></div>

<p>To use this python environment you can use the script: <code>startPythonEnv</code>. </p>
<p>When running with Event Stream and Postgres on the cloud use  IBMCLOUD argument:</p>
<div class="codehilite"><pre><span></span># refarch-reefer-ml project folder
./startPythonEnv.sh IBMCLOUD
</pre></div>

<h3 id="build-the-docker-image-for-jupyter-notebook">Build the docker image for Jupyter notebook</h3>
<p>We are using a special version of conda to add the postgresql and kafka libraries for python so we can access postgresql or kafka from notebook. The Dockerfile may use a <code>cert.pem</code> file, which contains the postgres certificate so the notebook can connect to postgresql service with SSL connection. </p>
<div class="codehilite"><pre><span></span>cd docker 
docker build -f docker-jupyter-tool -t ibmcase/jupyter .
</pre></div>

<p>To run this jupyter server use the startJupyterServer.sh script:</p>
<div class="codehilite"><pre><span></span># refarch-reefer-ml project folder
./startJupyterServer.sh IBMCLOUD
</pre></div>

<h3 id="create-the-postgresql-database">Create the postgresql database</h3>
<p>If you use POSTGRESQL on IBM Cloud, you need to get the SSL certificate and put it as postgres.pem under the simulator folder, or set POSTGRES_SSL_PEM to the path where to find this file.</p>
<p>The postgres.pem file needs to be in the simulator folder.</p>
<p>Run the <a href="">ReeferRepository.py</a> tool to create the database schema and to add some reference data like the product catalog:</p>
<div class="codehilite"><pre><span></span>./startPythonEnv.sh IBMCLOUD
&gt; python simulator/infrastructure/ReeferRepository.py
</pre></div>

<p>You should see the following trace:</p>
<div class="codehilite"><pre><span></span>Connect remote with ssl
(&#39;PostgreSQL 10.10 on x86_64-pc-linux-gnu, compiled by gcc (Debian 6.3.0-18+deb9u1) 6.3.0 20170516, 64-bit&#39;,)
[
    {
        &quot;container_id&quot;: &quot;C01&quot;,
        &quot;last_maintenance_date&quot;: null,
        &quot;reefer_model&quot;: &quot;20RF&quot;
    },
    {
        &quot;container_id&quot;: &quot;C02&quot;,
        &quot;last_maintenance_date&quot;: null,
        &quot;reefer_model&quot;: &quot;20RF&quot;
    },
    {
        &quot;container_id&quot;: &quot;C03&quot;,
        &quot;last_maintenance_date&quot;: null,
        &quot;reefer_model&quot;: &quot;40RH&quot;
    },
    {
        &quot;container_id&quot;: &quot;C04&quot;,
        &quot;last_maintenance_date&quot;: null,
        &quot;reefer_model&quot;: &quot;45RW&quot;
    }
]
[
    {
        &quot;content_type&quot;: 1,
        &quot;description&quot;: &quot;Carrots&quot;,
        &quot;product_id&quot;: &quot;P01&quot;,
        &quot;target_humidity_level&quot;: 0.4,
        &quot;target_temperature&quot;: 4.0
    },
    {
        &quot;content_type&quot;: 2,
        &quot;description&quot;: &quot;Banana&quot;,
        &quot;product_id&quot;: &quot;P02&quot;,
        &quot;target_humidity_level&quot;: 0.6,
        &quot;target_temperature&quot;: 6.0
    },
    {
        &quot;content_type&quot;: 1,
        &quot;description&quot;: &quot;Salad&quot;,
        &quot;product_id&quot;: &quot;P03&quot;,
        &quot;target_humidity_level&quot;: 0.4,
        &quot;target_temperature&quot;: 4.0
    },
    {
        &quot;content_type&quot;: 2,
        &quot;description&quot;: &quot;Avocado&quot;,
        &quot;product_id&quot;: &quot;P04&quot;,
        &quot;target_humidity_level&quot;: 0.4,
        &quot;target_temperature&quot;: 6.0
    }
]
(&#39;public&#39;, &#39;reefers&#39;, &#39;ibm-cloud-base-user&#39;, None, True, False, True, False)
(&#39;public&#39;, &#39;products&#39;, &#39;ibm-cloud-base-user&#39;, None, True, False, True, False)
(&#39;public&#39;, &#39;reefer_telemetries&#39;, &#39;ibm-cloud-base-user&#39;, None, True, False, True, False)
</pre></div>

<h2 id="project-approach">Project approach</h2>
<p>The solution covers different development areas and practices: event driven microservice, business process, data ops and machine learning model development. The software life cycle integrate the three main tracks of DevOps, DataOps and MLOps as presented in <a href="https://ibm-cloud-architecture.github.io/refarch-data-ai-analytics/methodology/">this methodology article</a>.</p>
<h3 id="devops">DevOps</h3>
<p>As all the services developed in this solution are event-driven we do not need to rephrase how we used event storming and applied the different patterns for each microservices. You can read the following articles to learn more:</p>
<ul>
<li><a href="https://ibm-cloud-architecture.github.io/refarch-eda/methodology/eventstorming/">Event storming workshop</a></li>
<li><a href="https://ibm-cloud-architecture.github.io/refarch-kc/design/readme/">From analysis to microservice using domain driven design</a></li>
<li><a href="https://ibm-cloud-architecture.github.io/refarch-kc-order-ms/ddd-applied/">Apply DDD to order microservice</a></li>
<li><a href="https://ibm-cloud-architecture.github.io/refarch-kc-container-ms/ES2DDD2MS/">Apply DDD to the container management microservice</a></li>
</ul>
<p>For the adoption of Appsody and CI/CD based on tektron, we present how we use Cloud Pak for application in the development of the scoring microservice in <a href="infuse/dev-scoring/">this note</a>.</p>
<p>To understand how to deploy each service on openshift see <a href="infuse/build-run/">this detailed note</a>.</p>
<h3 id="dataops">DataOps</h3>
<p><a href="collect/oss-collect-data/">Collect data with open source approach</a>.</p>
<p><a href="collect/cp4d-collect-data/">Collect data with cloud pak for data</a>.</p>
<h3 id="mlops">MLOps</h3>
<p>To use Jupyter, Sparks and kubeflow see <a href="analyze/oss-ml-dev/">this note</a></p>
<h2 id="further-readings">Further Readings</h2>
<ul>
<li><a href="https://developer.ibm.com/tutorials/iot-deep-learning-anomaly-detection-1">Romeo Kienzler anomaly detection article 1</a></li>
<li><a href="https://developer.ibm.com/tutorials/iot-deep-learning-anomaly-detection-2">Romeo Kienzler anomaly detection article 2</a></li>
<li><a href="https://developer.ibm.com/tutorials/iot-deep-learning-anomaly-detection-3/">Romeo Kienzler anomaly detection article 3</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="collect/products-postgres/" title="Get products into postgresql" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Get products into postgresql
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>